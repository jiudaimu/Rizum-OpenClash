# ============================
# OpenClash å…¨æ³¨é‡Šé…ç½®æ–‡ä»¶
# ç‰ˆæœ¬ï¼šv4.1
# ============================

# åŸºç¡€ç½‘ç»œé…ç½®
mixed-port: 7890          # æ··åˆä»£ç†ç«¯å£ (HTTP/SOCKS5 å…±ç”¨)
redir-port: 7892          # é€æ˜ä»£ç†ç«¯å£ (ç”¨äº iptables é‡å®šå‘)
tproxy-port: 7893         # TProxy é€æ˜ä»£ç†ç«¯å£ (æ”¯æŒ UDP)
allow-lan: true           # å…è®¸å±€åŸŸç½‘è®¾å¤‡è¿æ¥ä»£ç†
mode: Rule                # ä½¿ç”¨è§„åˆ™åˆ†æµæ¨¡å¼ (å¯é€‰ Global/Rule/Direct)
log-level: warning        # æ—¥å¿—çº§åˆ« (silent/error/warning/info/debug)
external-controller: 0.0.0.0:9090  # RESTful API ç›‘å¬åœ°å€ (ç®¡ç†é¢æ¿ä½¿ç”¨)
secret: "your_password"   # API è®¿é—®å¯†é’¥ (å»ºè®®ä½¿ç”¨å¼ºå¯†ç )
ipv6: true                # å¯ç”¨ IPv6 åŒæ ˆæ”¯æŒ
geodata-mode: true        # ä½¿ç”¨æ–°ç‰ˆ GeoIP æ•°æ®åº“æ ¼å¼

# DNS ç³»ç»Ÿé…ç½® (é˜²æ­¢æ±¡æŸ“)
dns:
  enable: true            # å¯ç”¨è‡ªå®šä¹‰ DNS æœåŠ¡å™¨
  listen: 0.0.0.0:1053    # DNS æœåŠ¡ç›‘å¬ç«¯å£
  ipv6: true              # å“åº” IPv6 DNS æŸ¥è¯¢
  enhanced-mode: fake-ip  # ä½¿ç”¨ Fake-IP æ¨¡å¼æå‡å“åº”é€Ÿåº¦
  fake-ip-range: 198.18.0.1/16  # Fake-IP åœ°å€æ±  (é¿å…ä¸çœŸå® IP å†²çª)
  default-nameserver:     # åˆå§‹ DNS æœåŠ¡å™¨ (ç”¨äºè§£æ nameserver åŸŸå)
    - 223.5.5.5           # é˜¿é‡Œå…¬å…± DNS
    - 2400:3200::1        # é˜¿é‡Œ IPv6 DNS
  nameserver:             # å¸¸è§„ DNS æœåŠ¡å™¨ (æŒ‰é¡ºåºæŸ¥è¯¢)
    - https://doh.pub/dns-query  # è…¾è®¯ DoH (åŠ å¯† DNS)
    - tls://dns.alidns.com:853   # é˜¿é‡Œ DoT (åŠ å¯† DNS)
  fallback-filter:        # å›é€€è¿‡æ»¤è§„åˆ™
    geoip: true           # éä¸­å›½ IP ä½¿ç”¨ fallback
    ipcidr:               # IP æ®µè¿‡æ»¤è§„åˆ™
      - 240.0.0.0/4       # è¿‡æ»¤éå¸¸è§„ IP æ®µ

# è®¢é˜…æºé…ç½® (éœ€ç”¨æˆ·æ›¿æ¢ SUB_URL)
proxy-providers:
  main_sub:               # è®¢é˜…æºåç§°
    type: http            # è®¢é˜…ç±»å‹ (http/file)
    url: "SUB_URL"        # è®¢é˜…é“¾æ¥ (éœ€ç”¨æˆ·å¡«å†™)
    path: ./subs/main.yaml  # æœ¬åœ°å­˜å‚¨è·¯å¾„
    interval: 43200       # æ›´æ–°é—´éš” (ç§’ï¼Œ12 å°æ—¶)
    filter: "é¦™æ¸¯|å°æ¹¾|å›å›½|(?i)hk|tw|cn"  # æ­£åˆ™è¿‡æ»¤èŠ‚ç‚¹åç§°
    health-check:         # èŠ‚ç‚¹å¥åº·æ£€æŸ¥
      enable: true        # å¯ç”¨è‡ªåŠ¨æ£€æµ‹
      interval: 300       # æ£€æŸ¥é—´éš” (5 åˆ†é’Ÿ)
      url: http://connect.rom.miui.com/generate_204  # æ£€æµ‹åœ°å€ (å›½å†…å¯è¾¾)

# ä»£ç†ç­–ç•¥ç»„æ¶æ„
proxy-groups:
  - name: "ğŸš€ æ™ºèƒ½ä¼˜é€‰"    # ç­–ç•¥ç»„æ˜¾ç¤ºåç§°
    type: url-test        # ç±»å‹ï¼šå»¶è¿Ÿæµ‹è¯• (è‡ªåŠ¨é€‰æ‹©æœ€ä½å»¶è¿ŸèŠ‚ç‚¹)
    url: http://www.qualcomm.cn/generate_204  # æµ‹è¯•åœ°å€ (å›½å†…æœåŠ¡å™¨)
    interval: 300         # æµ‹è¯•é—´éš” (5 åˆ†é’Ÿ)
    tolerance: 50         # å…è®¸å»¶è¿Ÿå·® (å•ä½ msï¼Œ50ms å†…ä¸åˆ‡æ¢)
    use: [main_sub]       # ä½¿ç”¨è®¢é˜…æºä¸­çš„èŠ‚ç‚¹
  
  - name: "ğŸ“º å“”å“©ä¸“çº¿"    # æµåª’ä½“ä¸“ç”¨ç»„
    type: select          # ç±»å‹ï¼šæ‰‹åŠ¨é€‰æ‹©
    proxies:              # å¯ç”¨èŠ‚ç‚¹åˆ—è¡¨
      - "ğŸš€ æ™ºèƒ½ä¼˜é€‰"      # é¦–é€‰æ™ºèƒ½ä¼˜é€‰èŠ‚ç‚¹
      - DIRECT            # å¤‡é€‰ç›´è¿
  
  - name: "ğŸ® VRé€šé“"          # ç­–ç•¥ç»„åç§° (æ˜¾ç¤ºåœ¨æ§åˆ¶é¢æ¿)
    type: url-test           # ç±»å‹ï¼šè‡ªåŠ¨é€‰æ‹©å»¶è¿Ÿæœ€ä½èŠ‚ç‚¹
    url: http://www.qualcomm.cn/generate_204  # æµ‹è¯•åœ°å€ (å›½å†…å¯è¾¾æ€§æ£€æµ‹)
    interval: 300            # æµ‹è¯•é—´éš” 300 ç§’ (5 åˆ†é’Ÿ)
    tolerance: 50            # å…è®¸ 50ms å»¶è¿Ÿå·® (æ³¢åŠ¨å°äºæ­¤å€¼ä¸åˆ‡æ¢)
    timeout: 2000            # è¶…æ—¶æ—¶é—´ 2000ms (2 ç§’)
    use: [main_sub]          # ä½¿ç”¨ main_sub è®¢é˜…æºçš„èŠ‚ç‚¹
    filter: "é¦™æ¸¯|(?i)hk"     # æ­£åˆ™è¿‡æ»¤é¦™æ¸¯èŠ‚ç‚¹ (ä¸­æ–‡/è‹±æ–‡æ ‡è¯†)
    # proxies:               # å¦‚éœ€æ‰‹åŠ¨æŒ‡å®šèŠ‚ç‚¹å¯å–æ¶ˆæ³¨é‡Š
    #   - é¦™æ¸¯èŠ‚ç‚¹01
    #   - é¦™æ¸¯èŠ‚ç‚¹02

# æµé‡è§„åˆ™ç³»ç»Ÿ (æŒ‰ä¼˜å…ˆçº§åŒ¹é…)
rules:
  # ç‰¹æ®Šåº”ç”¨è§„åˆ™ (æœ€é«˜ä¼˜å…ˆçº§)
  - DOMAIN,bil.ouo.chat,ğŸ® VRé€šé“,no-resolve  # æŒ‡å®šåŸŸåèµ° VR é€šé“ï¼Œä¸è§¦å‘ DNS è§£æ
  - DOMAIN-SUFFIX,91vrchat.com,ğŸ® VRé€šé“      # åŒ¹é…æ‰€æœ‰å­åŸŸå
  
  # æµåª’ä½“è§„åˆ™ (æ¬¡ä¼˜å…ˆçº§)
  - DOMAIN-SUFFIX,bilibili.com,ğŸ“º å“”å“©ä¸“çº¿    # ä¸»ç«™åŸŸå
  - DOMAIN-KEYWORD,upos,ğŸ“º å“”å“©ä¸“çº¿          # CDN æœåŠ¡å™¨å…³é”®å­—
  
  # å›½å†…ç›´è¿è§„åˆ™ (æœ€ååŒ¹é…)
  - GEOIP,CN,DIRECT,no-resolve              # ä¸­å›½ IP ç›´è¿ (ä¸è§¦å‘è§£æ)
  - MATCH,ğŸš€ æ™ºèƒ½ä¼˜é€‰                       # å‰©ä½™æµé‡èµ°æ™ºèƒ½ä¼˜é€‰

# TUN æ¨¡å¼é…ç½® (å¢å¼ºæ¨¡å¼)
tun:
  enable: true            # å¯ç”¨ TUN æ¨¡å¼ (éœ€è¦å†…æ ¸æ”¯æŒ)
  stack: system           # ä½¿ç”¨ç³»ç»Ÿåè®®æ ˆ (gvisor/system)
  auto-route: true        # è‡ªåŠ¨è®¾ç½®è·¯ç”±è§„åˆ™
  auto-detect-interface: true  # è‡ªåŠ¨æ£€æµ‹ç½‘ç»œæ¥å£

# å®éªŒæ€§åŠŸèƒ½
experimental:
  ignore-resolve-fail: true  # å¿½ç•¥ DNS è§£æå¤±è´¥ (é˜²æ­¢æ–­æµ)
  sniff-tls-sni: true     # å¯ç”¨ TLS SNI å—…æ¢ (å¢å¼ºåˆ†æµç²¾åº¦)

# è§„åˆ™é›†è‡ªåŠ¨æ›´æ–°
rule-providers:
  streaming_cn:           # å›½å†…æµåª’ä½“è§„åˆ™é›†
    type: http            # è¿œç¨‹è·å–ç±»å‹
    behavior: domain      # åŒ¹é…åŸŸåç±»å‹è§„åˆ™
    url: https://cdn.jsdelivr.net/gh/DivineEngine/Profiles@master/Clash/RuleSet/StreamingMedia/StreamingCN.yaml
    path: ./rulesets/streaming_cn.yaml  # æœ¬åœ°å­˜å‚¨è·¯å¾„
    interval: 86400       # æ¯å¤©è‡ªåŠ¨æ›´æ–°
